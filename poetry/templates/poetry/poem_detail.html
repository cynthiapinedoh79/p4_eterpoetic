{% extends "base.html" %}
{% load i18n %}
{% block title %}{{ poem.title_es|default:poem.title_en }} â€” EterPoetico{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between">
  <div>
    <h2 class="mb-1">{{ poem.title_es|default:poem.title_en }}</h2>
    <p class="text-muted mb-0">{{ poem.author.name }}</p>
  </div>
  {% if poem.body_en %}
  <div class="ms-3">
    <div class="btn-group" role="group" aria-label="Poem language toggle">
      <button id="btn-es" class="btn btn-secondary btn-sm" aria-pressed="true">ðŸ‡ªðŸ‡¸ ES</button>
      <button id="btn-en" class="btn btn-outline-secondary btn-sm">ðŸ‡¬ðŸ‡§ EN</button>
    </div>
  </div>
  {% endif %}
</div>
<hr>
<article id="poem-es" lang="es">
  <pre class="mt-3">{{ poem.body_es|default:poem.body_en }}</pre>
</article>
{% if poem.body_en %}
<article id="poem-en" lang="en" style="display:none;">
  <pre class="mt-3">{{ poem.body_en }}</pre>
</article>
{% endif %}
<script>
(function () {
  const hasEN = !!document.getElementById('poem-en');
  if (!hasEN) return;
  const $es = document.getElementById('poem-es');
  const $en = document.getElementById('poem-en');
  const btnES = document.getElementById('btn-es');
  const btnEN = document.getElementById('btn-en');
  const key = "ep-poem-lang:" + window.location.pathname;
  const saved = localStorage.getItem(key);
  if (saved === "en") showEN(); else showES();
  btnES.addEventListener('click', showES);
  btnEN.addEventListener('click', showEN);
  function showES() {
    $es.style.display = "";
    $en.style.display = "none";
    btnES.classList.remove("btn-outline-secondary");
    btnES.classList.add("btn-secondary");
    btnEN.classList.remove("btn-secondary");
    btnEN.classList.add("btn-outline-secondary");
    btnES.setAttribute("aria-pressed", "true");
    btnEN.setAttribute("aria-pressed", "false");
    localStorage.setItem(key, "es");
  }
  function showEN() {
    $es.style.display = "none";
    $en.style.display = "";
    btnEN.classList.remove("btn-outline-secondary");
    btnEN.classList.add("btn-secondary");
    btnES.classList.remove("btn-secondary");
    btnES.classList.add("btn-outline-secondary");
    btnEN.setAttribute("aria-pressed", "true");
    btnES.setAttribute("aria-pressed", "false");
    localStorage.setItem(key, "en");
  }
})();
</script>
{% endblock %}
