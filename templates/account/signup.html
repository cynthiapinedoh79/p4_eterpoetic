{% extends "base.html" %}
{% load i18n %}

{% block head_title %}{% trans "Sign Up" %}{% endblock %}

{% block content %}
<div class="login-page">
  <div class="login-card">
    <h3 class="login-title">{% trans "Sign Up" %}</h3>

    <p class="login-subtitle">
      {% blocktrans %}
         
        <div>
        <p>Welcome! Do you already have an account?
        <a class="link" href="{{ login_url }}">Sign Up</a>
        instead.
        </p>
        <hr>
        </div>
      {% endblocktrans %}
    </p>

    <form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
      {% csrf_token %}

      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {{ form.non_field_errors }}
      </div>
      {% endif %}

      {{ form.as_p }}

      {% if redirect_field_value %}
      <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
      {% endif %}

      <button class="btn btn-signup right" type="submit">
        {% trans "Sign Up" %} &raquo;
      </button>
    </form>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('signup_form');
        
        // Use the ID you verified for the confirmation field (id_password2)
        // We'll assume the primary password field is 'id_password'.
        // NOTE: If 'id_password' doesn't work, change it to 'id_password1'.
        const pw1  = document.getElementById('id_password');
        const pw2  = document.getElementById('id_password2');

        if (!form || !pw1 || !pw2) {
          // console.log("Password fields or form not found."); 
          return;
        }

        function validatePasswords() {
          // Clear any previous custom error message
          pw2.setCustomValidity(''); 

          // Only validate if both fields have some value and they don't match
          if (pw1.value && pw2.value && pw1.value !== pw2.value) {
            pw2.setCustomValidity('Passwords do not match.');
          }
        }

        // Validate as the user types in either field
        pw1.addEventListener('input', validatePasswords);
        pw2.addEventListener('input', validatePasswords);

        // Final check on submit
        form.addEventListener('submit', function (e) {
          validatePasswords(); // Run validation before submission check

          // This checks all HTML5 validation constraints, including your custom one
          if (!form.checkValidity()) {
            e.preventDefault();
            // Show the error tooltip on the field with the error
            pw2.reportValidity(); 
          }
        });
      });
    </script>


  </div>
</div>
{% endblock %}

